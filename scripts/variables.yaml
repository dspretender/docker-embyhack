version: '3'

# silent: true


# --- Configuration Variables ---
# These variables define important root paths and general settings for the build process.
# You can override these from the command line, e.g., `task -v EMBY_VERSION=...`
vars:
  PATH_TMP:
    sh: realpath "{{.TASKFILE_DIR}}/../tmp"
  PATH_BIN: "{{.PATH_TMP}}/bin"
  PATH_NODE: "{{.TASKFILE_DIR}}/node"
  PATH_DOTNET: "{{.TASKFILE_DIR}}/dotnet"
  PATH_DIST_TEMPLATE: "{{.TASKFILE_DIR}}/dist-template"
  PATH_BUILD_ROOT: "{{.PATH_TMP}}/build"
  # Define base step paths, these are then specialized as input/output/staging within tasks
  PATH_DEP_DOTNET: "{{.PATH_BUILD_ROOT}}/0-deps-dotnet"
  PATH_STEP_DOWNLOAD: "{{.PATH_BUILD_ROOT}}/1-download"
  PATH_STEP_UNPACK: "{{.PATH_BUILD_ROOT}}/2-unpack"
  PATH_STEP_STASH: "{{.PATH_BUILD_ROOT}}/3-stash"
  PATH_STEP_EDIT: "{{.PATH_BUILD_ROOT}}/4-edit"
  PATH_STEP_BUILD: "{{.PATH_BUILD_ROOT}}/5-build"
  PATH_DIST: "{{.PATH_BUILD_ROOT}}/dist"

  PATH_EMBY_SYSTEM: "{{.PATH_STEP_UNPACK}}/opt/emby-server/system"

  PATH_STRING_REPLACER: "{{.PATH_BIN}}/StringReplacer"
  COMMAND_DECOMPILE_DLL: "{{.PATH_BIN}}/ildasm -all -typelist -metadata=raw "
  COMMAND_COPY_RECURSIVE: "rsync -av -q "

# --- Environment Variables ---
# These variables are exposed as environment variables to the shell commands executed by tasks.
env:
  EMBY_VERSION: "4.8.11.0"
  EMBY_REPLACEMENT_URL: "https://example.com/"
  EMBY_PACKAGE: "emby-server-deb_{{.EMBY_VERSION}}_amd64.deb"
  EMBY_DOWNLOAD_URL: "https://github.com/MediaBrowser/Emby.Releases/releases/download/{{.EMBY_VERSION}}/{{.EMBY_PACKAGE}}"
  EMBY_TARGET_DLL: "Emby.Server.Implementations.dll Emby.Web.dll"
  EMBY_TARGET_JS: "dashboard-ui/embypremiere/embypremiere.js dashboard-ui/modules/emby-apiclient/connectionmanager.js"
  EMBY_TARGET_URL: "https://mb3admin.com/admin/service/registration/validateDevice https://mb3admin.com/admin/service/registration/validate https://mb3admin.com/admin/service/appstore/register https://mb3admin.com/admin/service/registration/getStatus"
  EMBY_REPLACE_PATTERN: "https://mb3admin.com/"
  NVM_DIR:
    sh: '[[ -n "$NVM_DIR" ]] && echo "$NVM_DIR" || echo "{{.HOME}}/.nvm"'

  NVM_SH: "{{.NVM_DIR}}/nvm.sh"
